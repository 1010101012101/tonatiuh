<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Tonatiuh : Automatically exported from code.google.com/p/tonatiuh">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Tonatiuh</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/pablo-benito/tonatiuh">View on GitHub</a>

          <h1 id="project_title">Tonatiuh</h1>
          <h2 id="project_tagline">Automatically exported from code.google.com/p/tonatiuh</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/pablo-benito/tonatiuh/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/pablo-benito/tonatiuh/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><img src="http://tonatiuhdocs.googlepages.com/Logodefinitivo301x115.gif" alt="http://tonatiuhdocs.googlepages.com/Logodefinitivo301x115.gif"></p>

<h1>
<a id="news" class="anchor" href="#news" aria-hidden="true"><span class="octicon octicon-link"></span></a>News</h1>

<h2>
<a id="tonatiuh-release-201-is-now-available" class="anchor" href="#tonatiuh-release-201-is-now-available" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tonatiuh release 2.0.1 is now available!</h2>

<p>This a major release of the program. It introduces major modifications on the usage of Tonatiuh from previous versions of the program. In this new release, the user must decide what ray tracing results to save and how to save them before starting the ray tracing. The results saving options are:</p>

<ul>
<li>
<em>Not export.</em> Selecting this option instructs Tonatiuh not to save any ray tracing results. This option could be of interest to verify that an optical system has been properly modelled before using the program to trace a large number of rays.</li>
<li>
<em>Binary data files.</em> Selecting this option instructs Tonatiuh to save the ray tracing results into one or several binary files. The format of the binary files vary depending on the information the user wants to store from every photon. The specific format of the binary files produce by Tonatiuh is detailed in an associated ASCII file.</li>
<li>
<em>SQL Database.</em> Selecting this option instructs Tonatiuh to save the ray tracing results in a SQL Database. Different database's tables are use to store different pieces of information. The table entitled "Surfaces" stores the basic identification information of the surfaces the photons are intersecting. The table entitled "Photons" stores the intersection-related information of each photon intersecting the concentrating geometry. Finally, the table entitled "WPhoton" stores the power associated to each photon.</li>
</ul>

<p>A wiki page will be created in the Wiki section of this website to explain in detail how to use the new features of Tonatiuh version 2.0.1. It is recommended not to switch to this version until obtaining a good understanding of how this new features work.</p>

<h1>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h1>

<p><em>The Tonatiuh project aims to create an open source, cutting-edge, accurate, and easy to use Monte Carlo ray tracer for the optical simulation of solar concentrating systems. It intends to advance the state-of-the-art of the simulation tools available for the design and analysis of solar concentrating systems, and to make those tools freely available to anyone interested in using and improving them.</em>
Some of the most relevant design goals of Tonatiuh are:</p>

<ul>
<li>To develop a robust theoretical foundation that will facilitate the optical simulation of almost any type of solar concentrating systems.</li>
<li>To exhibit a clean and flexible software architecture, that will allow the user to adapt, expand, increase, and modify its functionalities with ease.</li>
<li>To achieve operating system independence at source level, and run on all major platforms with none, or minor, modifications to its source code.</li>
<li>To provide the users with an advanced and easy-of-use Graphic User Interface (GUI).
Additional information on the rationale for this open source project, and on the goals, general characteristics, and current status of Tonatiuh is given in the two following videos. The first video is based on a <a href="http://en.wikipedia.org/wiki/Pecha_Kucha">Pecha Kucha presentation</a> given by Dr. Manuel J. Blanco at the University of Seville in September 2008. Although, the audio track is in Spanish, the video is closed-captioned in Spanih, and subtitled in English. Information on how to use the close-caption/subtitle features of YouTube videos can be found <a href="http://help.youtube.com/support/youtube/bin/answer.py?answer=100078">here</a>. The second video is based on an oral presentation of the paper entitled "Preliminary validation of Tonatiuh" given by Dr. Manuel J. Blanco on September 17th, at the 2009 International Energy Agency's SolarPACES Symposium, celebrated in Berlin, Germany.</li>
</ul>

<table>
<thead>
<tr>
<th align="left"><a href="http://www.youtube.com/watch?feature=player_embedded&amp;v=90FP79pGM_o" target="_blank"><img src="http://img.youtube.com/vi/90FP79pGM_o/0.jpg" width="425" height="344"></a></th>
<th align="left"><a href="http://www.youtube.com/watch?feature=player_embedded&amp;v=DUCgpTnapew" target="_blank"><img src="http://img.youtube.com/vi/DUCgpTnapew/0.jpg" width="425" height="344"></a></th>
</tr>
</thead>
<tbody>
</tbody>
</table>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h2>

<p>The use of extended Open Inventor files to represent the "scene" (i.e. the solar concentrating system, the sunlight model, etc.)
An advance and easy-to-use GUI providing:</p>

<ul>
<li>3D and tree views of the "scene" to simulate.</li>
<li>Handlers and manipulators to modify and query scene objects using 3D views.</li>
<li>Interface elements to manage the undo and redo of user actions.</li>
<li>Interface elements to define de type of Monte Carlo ray tracing to execute.
A pervasive plugin architecture which allos the user to:</li>
<li>Add new sunlight models.</li>
<li>Add new geometric surfaces.</li>
<li>Add new reflective materials.</li>
<li>(planned) Add new refractive materials.</li>
<li>(planned) Add new photon map and other results analyzers, and post-processors.</li>
<li>(planned) Add new spectrum models.
## Requirements ##
As any other ambitious open source program, Tonatiuh uses and leverages on several existing open source libraries, and tools. The principal open source resources used by Tonatiuh are:</li>
<li>Nokia QT for the Graphic User Interface (GUI).</li>
<li>Coin3D Toolkit for 3D Graphics Visualization.</li>
<li>Marble generic geographical map widget and framework.</li>
<li>CPPUnit for testing the code.
All these tools are used for developing Tonatiuh within the Eclipse IDE in a standard development environment used by the entire developing team.
## Tonatiuh's output files format ##
Tonatiuhâ€™s output file is a binary file whose format is independent of the host computer's operating system. The file stores real values one after the other in a block, with no spaces, separators, carriage returns, or line feeds separating the values.
The binary format used to store the values is <a href="http://en.wikipedia.org/wiki/Double_precision_floating-point_format#IEEE_754_double_precision_binary_floating-point_format:_binary64">Real64</a> with <a href="http://en.wikipedia.org/wiki/Endianness#Big-endian">big-endian byte ordering</a>. The first value stored in the file is the power per photon in watts (W). This real value is then followed by seven-tuples of real values, one per photon .
Every seven-tuple holds the following values in the specific order given:</li>
<li>PhotonID</li>
<li>x-coordinate</li>
<li>y-coordinate</li>
<li>z-coordinate</li>
<li>surface side ( 0 if is back side , 1 if is front side )</li>
<li>Previous PhotonID (0 if the photon is the first of a given ray)</li>
<li>Next PhotonID (0 is the photon is the last of a given ray)
Tonatiuh does not provide means for post-processing and representing the results of the ray tracing it carries out.</li>
</ul>

<p>At <a href="http://www.cener.com/es/index.asp">CENER</a> we use either Mathematica or R applications for post-processing of Tonatiuh's output binary files, in order to transform raw photon data into flux distributions estimates, and to present those fluxes estimates as graphs.</p>

<p>A typical Mathematica snippet for reading a Tonatiuh output file could be:</p>

<div class="highlight highlight-mathematica"><pre><span class="pl-c">(* Function to Read Tonatiuh's binary output file *)</span>
<span class="pl-en">ReadTonatiuhResults</span>[<span class="pl-v">filename_</span>] <span class="pl-k">:=</span> <span class="pl-en">BinaryReadList</span>[ <span class="pl-v">filename</span>, <span class="pl-s">"Real64"</span>,  <span class="pl-v">ByteOrdering</span> <span class="pl-k">-&gt;</span> <span class="pl-k">+</span><span class="pl-c1">1</span>]<span class="pl-k">;</span>

<span class="pl-c">(* Read Tonatiuh's ouput file and store content in fileData *)</span>
<span class="pl-v">rawData</span> <span class="pl-k">=</span> <span class="pl-en">ReadTonatiuhResults</span>[<span class="pl-s">"fileName.dat"</span>]<span class="pl-k">;</span>

<span class="pl-c">(* Store the power per photon in powerPerPhoton *)</span>
<span class="pl-v">powerPerPhoton</span> <span class="pl-k">=</span> <span class="pl-v">rawData</span>[[<span class="pl-c1">1</span>]]

<span class="pl-c">(* Create a matrix storing all the photon seven-tuples at a row per seven-tuple *)</span> 
<span class="pl-v">photonMap</span> <span class="pl-k">=</span> <span class="pl-en">Partition</span>[<span class="pl-v">fileData</span>[[<span class="pl-c1">2</span><span class="pl-k">;;</span><span class="pl-en">Length</span>[<span class="pl-v">fileData</span>]]],<span class="pl-c1">7</span>]<span class="pl-k">;</span>

<span class="pl-v">numberOfPhotons</span> <span class="pl-k">=</span> <span class="pl-en">Length</span>[<span class="pl-v">photonMap</span>]

<span class="pl-k">...</span>.</pre></div>

<p>A typical R snippet for reading a Tonatiuh output file could be:</p>

<div class="highlight highlight-r"><pre><span class="pl-c">#Open binary data file.</span>
<span class="pl-smi">fileName</span><span class="pl-k">&lt;-</span> file(<span class="pl-s"><span class="pl-pds">"</span>filePath/fileName.dat<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>rb<span class="pl-pds">"</span></span>)

<span class="pl-c">#Store the power per photon in poerPerPhoton variable.</span>
<span class="pl-smi">powerPerPhoton</span> <span class="pl-k">&lt;-</span> readBin(<span class="pl-smi">fileName</span>, <span class="pl-v">what</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>numeric<span class="pl-pds">"</span></span>, <span class="pl-v">n</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">endian</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>big<span class="pl-pds">"</span></span>)

<span class="pl-c">#Create a vector with photons all the information.</span>
<span class="pl-smi">endOfFile</span><span class="pl-k">&lt;-</span><span class="pl-c1">FALSE</span>
<span class="pl-smi">photonData</span><span class="pl-k">&lt;-</span>vector( <span class="pl-v">mode</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>numeric<span class="pl-pds">"</span></span>)
<span class="pl-k">while</span>( <span class="pl-k">!</span><span class="pl-smi">endOfFile</span> )
{
   <span class="pl-smi">photon</span><span class="pl-k">&lt;-</span>readBin(<span class="pl-smi">fileName</span>, <span class="pl-v">what</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>numeric<span class="pl-pds">"</span></span>, <span class="pl-v">n</span><span class="pl-k">=</span><span class="pl-c1">7</span>, <span class="pl-v">endian</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>big<span class="pl-pds">"</span></span>)
   <span class="pl-k">if</span>( length( <span class="pl-smi">photon</span> ) <span class="pl-k">&lt;</span> <span class="pl-c1">7</span> ) <span class="pl-v">endOfFile</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span> <span class="pl-k">else</span> <span class="pl-smi">photonData</span><span class="pl-k">&lt;-</span>append( <span class="pl-smi">photonData</span>, <span class="pl-smi">photon</span> )
}
<span class="pl-c">#Close the data file.</span>
close(<span class="pl-smi">fileName</span>)

<span class="pl-c">#Compute the number of photons in the vector. all the photon sextuples at a row per #sextuple </span>
<span class="pl-smi">nPhotons</span><span class="pl-k">&lt;-</span>length( <span class="pl-smi">photonData</span> ) <span class="pl-k">/</span> <span class="pl-c1">7</span>
<span class="pl-smi">photonMap</span><span class="pl-k">&lt;-</span><span class="pl-k">matrix</span>(  <span class="pl-smi">photonData</span> , <span class="pl-v">nrow</span><span class="pl-k">=</span> <span class="pl-smi">nPhotons</span>, <span class="pl-v">ncol</span><span class="pl-k">=</span><span class="pl-c1">7</span>, <span class="pl-v">byrow</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span> )

<span class="pl-k">...</span></pre></div>

<p><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" alt="Creative Commons License"></a><br>This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License</a>.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Tonatiuh maintained by <a href="https://github.com/pablo-benito">pablo-benito</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
